datos <- readr::read_csv(file = "../../../docencia-R-datascience-2324/entregas/ENTREGA 3 BIS/datos_elecciones_brutos.csv")
datos_tidy <- datos |>
+1s
library(tidyverse)
table4a
datos
datos_tidy <- datos |> pivot_longer(cols = -(tipo_eleccion:votos_candidaturas), names_to = "partido", values_to = "votos", values_drop_na = TRUE)
datos_tidy
datos_tidy |> filter(partido == "PARTIDO POPULAR")
datos_tidy |> filter(str_detect(partido, "PARTIDO POPULAR"))
datos_tidy |> filter(str_detect(partido, "PARTIDO POPULAR")) |> select(partido, votos)
datos_tidy |> filter(str_detect(partido, "PARTIDO POPULAR")) |> select(partido, votos) arrange(desc(partido))
datos_tidy |> filter(str_detect(partido, "PARTIDO POPULAR")) |> select(partido, votos) |>  arrange(desc(partido))
datos_tidy |> filter(str_detect(partido, "PARTIDO NACIONALISTA VASCO")) |> select(partido, votos) |>  arrange(desc(partido))
cod_mun <- read_csv(file = "../../../docencia-R-datascience-2324/entregas/ENTREGA 3 BIS/cod_mun.csv")
cod_mun
datos_tidy |> summarise(across(where(is.numeric), mean))
datos_elecciones <- read_csv(file = "./datos/datos_elecciones_brutos.csv")
#| echo: false
rm(list = ls()) # Borramos variables de environment
library(tidyverse)
datos_elecciones <- read_csv(file = "./datos/datos_elecciones_brutos.csv")
cod_mun <- read_csv(file = "./datos/cod_mun.csv")
encuestas <- read_csv(file = "./datos/historical_surveys.csv")
siglas <- read_csv(file = "./datos/siglas.csv")
View(datos_elecciones)
View(cod-mun)
View(cod_mun)
View(encuestas)
View(siglas)
datos |>
summarise(across_everyting(), n_distinct)
datos_elecciones_brutos |>
summarise(across_everyting(), n_distinct)
datos_elecciones_brutos <- read_csv(file = "./datos/datos_elecciones_brutos.csv")
cod_mun <- read_csv(file = "./datos/cod_mun.csv")
encuestas <- read_csv(file = "./datos/historical_surveys.csv")
siglas <- read_csv(file = "./datos/siglas.csv")
datos_elecciones_brutos |>
summarise(across_everyting(), n_distinct)
datos_elecciones_brutos |>
summarise(across(everyting(), n_distinct))
datos_elecciones_brutos |>
summarise(across(everything(), n_distinct))
summarise(across(everything(), n_distinct)) == 1
datos_elecciones <- datos_elecciones_brutos |>
select(where(~ n_distinct(.) > 1))
datos_elecciones
glimpse(datos_elecciones)
glimpse(datos_elecciones_brutos)
datos_elecciones_brutos |>
summarise(across(everything(), n_distinct))
datos_elecciones <- datos_elecciones_brutos |>
select(where(~ n_distinct(.) > 1))
datos_elecciones_tidy <- datos_elecciones_brutos |>
pivot_longer(cols = - ("anno":"votos_candidaturas"), names_to = "partido",
values_to = "votos",
values_drop_na = TRUE)
datos_elecciones_brutos |>
summarise(across(everything(), n_distinct))
datos_elecciones <- datos_elecciones_brutos |>
select(where(~ n_distinct(.) > 1))
datos_elecciones_tidy <- datos_elecciones |>
pivot_longer(cols = - ("anno":"votos_candidaturas"), names_to = "partido",
values_to = "votos",
values_drop_na = TRUE)
glimpse(datos_elecciones_tidy)
datos_elecciones_tidy <- datos_elecciones_tidy |>
left_join(siglas, by = c("partido" == "denominacion"))
datos_elecciones_tidy <- datos_elecciones_tidy |>
left_join(siglas, by = c("partido" = "denominacion"))
glimspe(datos_elecciones_tidy)
glimpse(datos_elecciones_tidy)
datos_elecciones_tidy <- datos_elecciones_tidy |>
left_join(siglas, by = c("partido" = "denominacion"))
datos_elecciones_tidy <- datos_elecciones_tidy |>
recolocate(siglas, .after = partido)
datos_elecciones_tidy <- datos_elecciones_tidy |>
left_join(siglas, by = c("partido" = "denominacion"))
datos_elecciones_tidy <- datos_elecciones_tidy |>
relocate(siglas, .after = partido)
glimpse(datos_elecciones_tidy)
partido
datos_elecciones_tidy$pais
datos_elecciones_tidy$partido
datos_elecciones_tidy <- datos_elecciones |>
mutate(
siglas = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
str_detect(str_to_lower(siglas), "POSI|PSE-EE-PSOE|PSOE-PROGR.|SIEX|PSDEG-PSOE|PSOE|PSPC|PSE-EE(PSOE)|PSA|PSdeG-PSOE|PSOE de A|PSE-EE (PSOE)|P.S.O.E.|P.O.S.I.|PSD-FIA|PSOE-A|SSP-SxTF-EQUO|SXT|PSE-EE|PSE-EE|PSOE-NCa|PSC|FIA") ~ "PSOE",
str_detect(str_to_lower(siglas), "CENB|C's|Cenb|CenB|CNB|pCUA|C,S|CCD|FAC|U.C.I.T.|C´s|CILUS|CRA|CCD-CI|Cs|CILU-LINARE") ~ "Cs",
str_detect(str_to_lower(siglas), "EAJ-PNV|E.A.J.-P.N.V.") ~ "PNV",
str_detect(str_to_lower(siglas), "BNG|B.N.G.|NÓS|BNG-NÓS") ~ "BNG",
str_detect(str_to_lower(siglas), "COMPROMÍS-Q|PODEMOS-COM|PODEMOS - C|COMPROMÍS 2|MÉS COMPROM") ~ "COMPROMÍS",
str_detect(str_to_lower(siglas), "CIU|CiU") ~ "CIU",
str_detect(str_to_lower(siglas), "B-LV|EB-IU|IU|LVE|IULV-CA|LV|EU-IU|LV-GV|VERDES|PAVIEL|LV-CM|IU-CM|LVRM|CCS|IUN-NEB|PAS|IUC|CENB|LV-E|IU-SIEX|IU-LV|LVCM|CCSE|IU-BA|VERDES-IUC-AC25|EB-B|C's|Cenb|LV-EV|CenB|I.U.|EV-LV|AGRUCI|I.C.Bur|LOS VERDES|CNB|L.V.|pCUA|LOS VERDES DE EUROPA|C,S|LVCM-LVE|IU-CM.|I.U.R.M.|IU-B.A-LOS VERDES|UCPIC|AMAIUR|IUCLM-LV|EUPV-LV|IUCL|IU-VERDES-SIEX: La Izquierda Plural|CCD|IU-V-SIEX: LA IZQUIERDA PLURAL|CHA-IU|FAC|ACIMA|IUV-RM|IU-IX|IU CyL|IUC-IpH-LV|IUCyL|U.C.I.T.|IUCM-LV|IU-PDSC|PODEMOS-AHA|UP-UPeC|PODEMOS|PODEMOS-COM|CENTRO MODE|IULV-CA,UPe|C´s|UPB: IU-UPe|IULV-CA, UP|PODEMOS - C|UP: IULV-CA|PODEMOS-Aho|IU-CHA-UPeC|CILUS|CRA|X LA IZQUIE|IU-B-UPeC|IU-UPeC-IAS|CANARIAS DE|IUC-UPeC|EN POSITIU|UPeC-IU-IZC|JS,PC|UNIDAD POPU|PODEMOS/AHAL DUGU-IU-EQUO|PODEMOS-IU-EQUO|CENTRO MODERADO|PODEMOS-IU-|PODEMOS-IU-EQUO-CLIAS|PODEMOS-IU-EQUO-BATZARRE|PODEMOS-IU-EQUO-SEGOVIEMOS|PODEMOS-IU-EQUO-IZCA|CCD-CI|UNIDOS PODEMOS|Cs|AVANT-LOS V|PODEMOS-EUP|PODEMOS-IU|FRONT REPUB|AVANT ADELA|PODEMOS-EU-|CILU-LINARE|PODEMOS-IX-|PODEMOS-EUPV|AVANT ADELANTE LOS VERDES|PODEMOS-IU LV CA|PODEMOS-EUIB|AVANT LOS VERDES|PODEMOS-EU|PODEMOS-IU-BATZARRE|PODEMOS-IX|MDyC") ~ "UP-IU",
str_detect(str_to_lower(siglas), "FRONT-ERC|ERC|PSM-EN,EU,EV,ER|ESQUERRA|esquerra|ERC-RI.cat|ERC - RI.cat / ESQUERRA|ERC-CATSÍ|ERC-CATSI|ERC-SOBIRAN|ERC-SOBIRANISTES") ~ "ERC",
#str_detect(str_to_lower(siglas), "") ~ "",
#str_detect(str_to_lower(siglas), "") ~ "",
str_detect(str_to_lower(siglas), "VOX") ~ "VOX",
TRUE ~ "OTROS"
),
fecha = glue::glue("{anno}-{mes}"),
id_mun = glue::glue("{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}")) |>
mutate(votos = sum(votos), .by = c(fecha, id_mun, siglas)) |>
distinct(fecha, id_mun, siglas, .keep_all = TRUE) |>
mutate(porc_voto = (votos / (votos_candidaturas + votos_candidaturas)) * 100,
.by = c(fecha, id_mun))
datos_elecciones_tidy <- datos_elecciones |>
mutate(
siglas_comun = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
str_detect(str_to_lower(siglas), "POSI|PSE-EE-PSOE|PSOE-PROGR.|SIEX|PSDEG-PSOE|PSOE|PSPC|PSE-EE(PSOE)|PSA|PSdeG-PSOE|PSOE de A|PSE-EE (PSOE)|P.S.O.E.|P.O.S.I.|PSD-FIA|PSOE-A|SSP-SxTF-EQUO|SXT|PSE-EE (PSO|PSE-EE|PSOE-NCa|PSC|FIA") ~ "PSOE",
str_detect(str_to_lower(siglas), "CENB|C's|Cenb|CenB|CNB|pCUA|C,S|CCD|FAC|U.C.I.T.|C´s|CILUS|CRA|CCD-CI|Cs|CILU-LINARE") ~ "Cs",
str_detect(str_to_lower(siglas), "EAJ-PNV|E.A.J.-P.N.V.") ~ "PNV",
str_detect(str_to_lower(siglas), "BNG|B.N.G.|NÓS|BNG-NÓS") ~ "BNG",
str_detect(str_to_lower(siglas), "COMPROMÍS-Q|PODEMOS-COM|PODEMOS - C|COMPROMÍS 2|MÉS COMPROM") ~ "COMPROMÍS",
str_detect(str_to_lower(siglas), "CIU|CiU") ~ "CIU",
str_detect(str_to_lower(siglas), "B-LV|EB-IU|IU|LVE|IULV-CA|LV|EU-IU|LV-GV|VERDES|PAVIEL|LV-CM|IU-CM|LVRM|CCS|IUN-NEB|PAS|IUC|CENB|LV-E|IU-SIEX|IU-LV|LVCM|CCSE|IU-BA|VERDES-IUC-AC25|EB-B|C's|Cenb|LV-EV|CenB|I.U.|EV-LV|AGRUCI|I.C.Bur|LOS VERDES|CNB|L.V.|pCUA|LOS VERDES DE EUROPA|C,S|LVCM-LVE|IU-CM.|I.U.R.M.|IU-B.A-LOS VERDES|UCPIC|AMAIUR|IUCLM-LV|EUPV-LV|IUCL|IU-VERDES-SIEX: La Izquierda Plural|CCD|IU-V-SIEX: LA IZQUIERDA PLURAL|CHA-IU|FAC|ACIMA|IUV-RM|IU-IX|IU CyL|IUC-IpH-LV|IUCyL|U.C.I.T.|IUCM-LV|IU-PDSC|PODEMOS-AHA|UP-UPeC|PODEMOS|PODEMOS-COM|CENTRO MODE|IULV-CA,UPe|C´s|UPB: IU-UPe|IULV-CA, UP|PODEMOS - C|UP: IULV-CA|PODEMOS-Aho|IU-CHA-UPeC|CILUS|CRA|X LA IZQUIE|IU-B-UPeC|IU-UPeC-IAS|CANARIAS DE|IUC-UPeC|EN POSITIU|UPeC-IU-IZC|JS,PC|UNIDAD POPU|PODEMOS/AHAL DUGU-IU-EQUO|PODEMOS-IU-EQUO|CENTRO MODERADO|PODEMOS-IU-|PODEMOS-IU-EQUO-CLIAS|PODEMOS-IU-EQUO-BATZARRE|PODEMOS-IU-EQUO-SEGOVIEMOS|PODEMOS-IU-EQUO-IZCA|CCD-CI|UNIDOS PODEMOS|Cs|AVANT-LOS V|PODEMOS-EUP|PODEMOS-IU|FRONT REPUB|AVANT ADELA|PODEMOS-EU-|CILU-LINARE|PODEMOS-IX-|PODEMOS-EUPV|AVANT ADELANTE LOS VERDES|PODEMOS-IU LV CA|PODEMOS-EUIB|AVANT LOS VERDES|PODEMOS-EU|PODEMOS-IU-BATZARRE|PODEMOS-IX|MDyC") ~ "UP-IU",
str_detect(str_to_lower(siglas), "FRONT-ERC|ERC|PSM-EN,EU,EV,ER|ESQUERRA|esquerra|ERC-RI.cat|ERC - RI.cat / ESQUERRA|ERC-CATSÍ|ERC-CATSI|ERC-SOBIRAN|ERC-SOBIRANISTES") ~ "ERC",
#str_detect(str_to_lower(siglas), "") ~ "",
#str_detect(str_to_lower(siglas), "") ~ "",
str_detect(str_to_lower(siglas), "VOX") ~ "VOX",
TRUE ~ "OTROS"
),
fecha = glue::glue("{anno}-{mes}"),
id_mun = glue::glue("{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}")) |>
mutate(votos = sum(votos), .by = c(fecha, id_mun, siglas)) |>
distinct(fecha, id_mun, siglas, .keep_all = TRUE) |>
mutate(porc_voto = (votos / (votos_candidaturas + votos_candidaturas)) * 100,
.by = c(fecha, id_mun))
datos_elecciones_tidy <- datos_elecciones |>
mutate(
siglas_comun = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
str_detect(str_to_lower(siglas), "POSI|PSE-EE-PSOE|PSOE-PROGR.|SIEX|PSDEG-PSOE|PSOE|PSPC|PSE-EE(PSOE)|PSA|PSdeG-PSOE|PSOE de A|PSE-EE (PSOE)|P.S.O.E.|P.O.S.I.|PSD-FIA|PSOE-A|SSP-SxTF-EQUO|SXT|PSE-EE|PSE-EE|PSOE-NCa|PSC|FIA") ~ "PSOE",
str_detect(str_to_lower(siglas), "CENB|C's|Cenb|CenB|CNB|pCUA|C,S|CCD|FAC|U.C.I.T.|C´s|CILUS|CRA|CCD-CI|Cs|CILU-LINARE") ~ "Cs",
str_detect(str_to_lower(siglas), "EAJ-PNV|E.A.J.-P.N.V.") ~ "PNV",
str_detect(str_to_lower(siglas), "BNG|B.N.G.|NÓS|BNG-NÓS") ~ "BNG",
str_detect(str_to_lower(siglas), "COMPROMÍS-Q|PODEMOS-COM|PODEMOS - C|COMPROMÍS 2|MÉS COMPROM") ~ "COMPROMÍS",
str_detect(str_to_lower(siglas), "CIU|CiU") ~ "CIU",
str_detect(str_to_lower(siglas), "B-LV|EB-IU|IU|LVE|IULV-CA|LV|EU-IU|LV-GV|VERDES|PAVIEL|LV-CM|IU-CM|LVRM|CCS|IUN-NEB|PAS|IUC|CENB|LV-E|IU-SIEX|IU-LV|LVCM|CCSE|IU-BA|VERDES-IUC-AC25|EB-B|C's|Cenb|LV-EV|CenB|I.U.|EV-LV|AGRUCI|I.C.Bur|LOS VERDES|CNB|L.V.|pCUA|LOS VERDES DE EUROPA|C,S|LVCM-LVE|IU-CM.|I.U.R.M.|IU-B.A-LOS VERDES|UCPIC|AMAIUR|IUCLM-LV|EUPV-LV|IUCL|IU-VERDES-SIEX: La Izquierda Plural|CCD|IU-V-SIEX: LA IZQUIERDA PLURAL|CHA-IU|FAC|ACIMA|IUV-RM|IU-IX|IU CyL|IUC-IpH-LV|IUCyL|U.C.I.T.|IUCM-LV|IU-PDSC|PODEMOS-AHA|UP-UPeC|PODEMOS|PODEMOS-COM|CENTRO MODE|IULV-CA,UPe|C´s|UPB: IU-UPe|IULV-CA, UP|PODEMOS - C|UP: IULV-CA|PODEMOS-Aho|IU-CHA-UPeC|CILUS|CRA|X LA IZQUIE|IU-B-UPeC|IU-UPeC-IAS|CANARIAS DE|IUC-UPeC|EN POSITIU|UPeC-IU-IZC|JS,PC|UNIDAD POPU|PODEMOS/AHAL DUGU-IU-EQUO|PODEMOS-IU-EQUO|CENTRO MODERADO|PODEMOS-IU-|PODEMOS-IU-EQUO-CLIAS|PODEMOS-IU-EQUO-BATZARRE|PODEMOS-IU-EQUO-SEGOVIEMOS|PODEMOS-IU-EQUO-IZCA|CCD-CI|UNIDOS PODEMOS|Cs|AVANT-LOS V|PODEMOS-EUP|PODEMOS-IU|FRONT REPUB|AVANT ADELA|PODEMOS-EU-|CILU-LINARE|PODEMOS-IX-|PODEMOS-EUPV|AVANT ADELANTE LOS VERDES|PODEMOS-IU LV CA|PODEMOS-EUIB|AVANT LOS VERDES|PODEMOS-EU|PODEMOS-IU-BATZARRE|PODEMOS-IX|MDyC") ~ "UP-IU",
str_detect(str_to_lower(siglas), "FRONT-ERC|ERC|PSM-EN,EU,EV,ER|ESQUERRA|esquerra|ERC-RI.cat|ERC - RI.cat / ESQUERRA|ERC-CATSÍ|ERC-CATSI|ERC-SOBIRAN|ERC-SOBIRANISTES") ~ "ERC",
#str_detect(str_to_lower(siglas), "") ~ "",
#str_detect(str_to_lower(siglas), "") ~ "",
str_detect(str_to_lower(siglas), "VOX") ~ "VOX",
TRUE ~ "OTROS"
),
fecha = glue::glue("{anno}-{mes}"),
id_mun = glue::glue("{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}")) |>
mutate(votos = sum(votos), .by = c(fecha, id_mun, siglas)) |>
distinct(fecha, id_mun, siglas, .keep_all = TRUE) |>
mutate(porc_voto = (votos / (votos_candidaturas + votos_candidaturas)) * 100,
.by = c(fecha, id_mun))
glimpse(datos_elecciones_tidy)
datos_elecciones_tidy <- datos_elecciones |>
pivot_longer(cols = - ("anno":"votos_candidaturas"), names_to = "partido",
values_to = "votos",
values_drop_na = TRUE)
datos_elecciones_tidy <- datos_elecciones_tidy |>
left_join(siglas, by = c("partido" = "denominacion"))
datos_elecciones_tidy <- datos_elecciones_tidy |>
relocate(siglas, .after = partido)
datos_elecciones_tidy <- datos_elecciones |>
mutate(
siglas_comun = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
str_detect(str_to_lower(siglas), "POSI|PSE-EE-PSOE|PSOE-PROGR.|SIEX|PSDEG-PSOE|PSOE|PSPC|PSE-EE(PSOE)|PSA|PSdeG-PSOE|PSOE de A|PSE-EE (PSOE)|P.S.O.E.|P.O.S.I.|PSD-FIA|PSOE-A|SSP-SxTF-EQUO|SXT|PSE-EE|PSE-EE|PSOE-NCa|PSC|FIA") ~ "PSOE",
str_detect(str_to_lower(siglas), "CENB|C's|Cenb|CenB|CNB|pCUA|C,S|CCD|FAC|U.C.I.T.|C´s|CILUS|CRA|CCD-CI|Cs|CILU-LINARE") ~ "Cs",
str_detect(str_to_lower(siglas), "EAJ-PNV|E.A.J.-P.N.V.") ~ "PNV",
str_detect(str_to_lower(siglas), "BNG|B.N.G.|NÓS|BNG-NÓS") ~ "BNG",
str_detect(str_to_lower(siglas), "COMPROMÍS-Q|PODEMOS-COM|PODEMOS - C|COMPROMÍS 2|MÉS COMPROM") ~ "COMPROMÍS",
str_detect(str_to_lower(siglas), "CIU|CiU") ~ "CIU",
str_detect(str_to_lower(siglas), "B-LV|EB-IU|IU|LVE|IULV-CA|LV|EU-IU|LV-GV|VERDES|PAVIEL|LV-CM|IU-CM|LVRM|CCS|IUN-NEB|PAS|IUC|CENB|LV-E|IU-SIEX|IU-LV|LVCM|CCSE|IU-BA|VERDES-IUC-AC25|EB-B|C's|Cenb|LV-EV|CenB|I.U.|EV-LV|AGRUCI|I.C.Bur|LOS VERDES|CNB|L.V.|pCUA|LOS VERDES DE EUROPA|C,S|LVCM-LVE|IU-CM.|I.U.R.M.|IU-B.A-LOS VERDES|UCPIC|AMAIUR|IUCLM-LV|EUPV-LV|IUCL|IU-VERDES-SIEX: La Izquierda Plural|CCD|IU-V-SIEX: LA IZQUIERDA PLURAL|CHA-IU|FAC|ACIMA|IUV-RM|IU-IX|IU CyL|IUC-IpH-LV|IUCyL|U.C.I.T.|IUCM-LV|IU-PDSC|PODEMOS-AHA|UP-UPeC|PODEMOS|PODEMOS-COM|CENTRO MODE|IULV-CA,UPe|C´s|UPB: IU-UPe|IULV-CA, UP|PODEMOS - C|UP: IULV-CA|PODEMOS-Aho|IU-CHA-UPeC|CILUS|CRA|X LA IZQUIE|IU-B-UPeC|IU-UPeC-IAS|CANARIAS DE|IUC-UPeC|EN POSITIU|UPeC-IU-IZC|JS,PC|UNIDAD POPU|PODEMOS/AHAL DUGU-IU-EQUO|PODEMOS-IU-EQUO|CENTRO MODERADO|PODEMOS-IU-|PODEMOS-IU-EQUO-CLIAS|PODEMOS-IU-EQUO-BATZARRE|PODEMOS-IU-EQUO-SEGOVIEMOS|PODEMOS-IU-EQUO-IZCA|CCD-CI|UNIDOS PODEMOS|Cs|AVANT-LOS V|PODEMOS-EUP|PODEMOS-IU|FRONT REPUB|AVANT ADELA|PODEMOS-EU-|CILU-LINARE|PODEMOS-IX-|PODEMOS-EUPV|AVANT ADELANTE LOS VERDES|PODEMOS-IU LV CA|PODEMOS-EUIB|AVANT LOS VERDES|PODEMOS-EU|PODEMOS-IU-BATZARRE|PODEMOS-IX|MDyC") ~ "UP-IU",
str_detect(str_to_lower(siglas), "FRONT-ERC|ERC|PSM-EN,EU,EV,ER|ESQUERRA|esquerra|ERC-RI.cat|ERC - RI.cat / ESQUERRA|ERC-CATSÍ|ERC-CATSI|ERC-SOBIRAN|ERC-SOBIRANISTES") ~ "ERC",
#str_detect(str_to_lower(siglas), "") ~ "",
#str_detect(str_to_lower(siglas), "") ~ "",
str_detect(str_to_lower(siglas), "VOX") ~ "VOX",
TRUE ~ "OTROS"
),
fecha = glue::glue("{anno}-{mes}"),
id_mun = glue::glue("{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}")) |>
mutate(votos = sum(votos), .by = c(fecha, id_mun, siglas)) |>
distinct(fecha, id_mun, siglas, .keep_all = TRUE) |>
mutate(porc_voto = (votos / (votos_candidaturas + votos_candidaturas)) * 100,
.by = c(fecha, id_mun))
glimpse(datos_elecciones_tidy)
datos_elecciones_tidy <- datos_elecciones |>
mutate(
siglas_comun = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
TRUE ~ "OTROS"))
datos_elecciones_tidy <- datos_elecciones_tidy |>
mutate(
siglas_comun = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
str_detect(str_to_lower(siglas), "POSI|PSE-EE-PSOE|PSOE-PROGR.|SIEX|PSDEG-PSOE|PSOE|PSPC|PSE-EE(PSOE)|PSA|PSdeG-PSOE|PSOE de A|PSE-EE (PSOE)|P.S.O.E.|P.O.S.I.|PSD-FIA|PSOE-A|SSP-SxTF-EQUO|SXT|PSE-EE|PSE-EE|PSOE-NCa|PSC|FIA") ~ "PSOE",
str_detect(str_to_lower(siglas), "CENB|C's|Cenb|CenB|CNB|pCUA|C,S|CCD|FAC|U.C.I.T.|C´s|CILUS|CRA|CCD-CI|Cs|CILU-LINARE") ~ "Cs",
str_detect(str_to_lower(siglas), "EAJ-PNV|E.A.J.-P.N.V.") ~ "PNV",
str_detect(str_to_lower(siglas), "BNG|B.N.G.|NÓS|BNG-NÓS") ~ "BNG",
str_detect(str_to_lower(siglas), "COMPROMÍS-Q|PODEMOS-COM|PODEMOS - C|COMPROMÍS 2|MÉS COMPROM") ~ "COMPROMÍS",
str_detect(str_to_lower(siglas), "CIU|CiU") ~ "CIU",
str_detect(str_to_lower(siglas), "B-LV|EB-IU|IU|LVE|IULV-CA|LV|EU-IU|LV-GV|VERDES|PAVIEL|LV-CM|IU-CM|LVRM|CCS|IUN-NEB|PAS|IUC|CENB|LV-E|IU-SIEX|IU-LV|LVCM|CCSE|IU-BA|VERDES-IUC-AC25|EB-B|C's|Cenb|LV-EV|CenB|I.U.|EV-LV|AGRUCI|I.C.Bur|LOS VERDES|CNB|L.V.|pCUA|LOS VERDES DE EUROPA|C,S|LVCM-LVE|IU-CM.|I.U.R.M.|IU-B.A-LOS VERDES|UCPIC|AMAIUR|IUCLM-LV|EUPV-LV|IUCL|IU-VERDES-SIEX: La Izquierda Plural|CCD|IU-V-SIEX: LA IZQUIERDA PLURAL|CHA-IU|FAC|ACIMA|IUV-RM|IU-IX|IU CyL|IUC-IpH-LV|IUCyL|U.C.I.T.|IUCM-LV|IU-PDSC|PODEMOS-AHA|UP-UPeC|PODEMOS|PODEMOS-COM|CENTRO MODE|IULV-CA,UPe|C´s|UPB: IU-UPe|IULV-CA, UP|PODEMOS - C|UP: IULV-CA|PODEMOS-Aho|IU-CHA-UPeC|CILUS|CRA|X LA IZQUIE|IU-B-UPeC|IU-UPeC-IAS|CANARIAS DE|IUC-UPeC|EN POSITIU|UPeC-IU-IZC|JS,PC|UNIDAD POPU|PODEMOS/AHAL DUGU-IU-EQUO|PODEMOS-IU-EQUO|CENTRO MODERADO|PODEMOS-IU-|PODEMOS-IU-EQUO-CLIAS|PODEMOS-IU-EQUO-BATZARRE|PODEMOS-IU-EQUO-SEGOVIEMOS|PODEMOS-IU-EQUO-IZCA|CCD-CI|UNIDOS PODEMOS|Cs|AVANT-LOS V|PODEMOS-EUP|PODEMOS-IU|FRONT REPUB|AVANT ADELA|PODEMOS-EU-|CILU-LINARE|PODEMOS-IX-|PODEMOS-EUPV|AVANT ADELANTE LOS VERDES|PODEMOS-IU LV CA|PODEMOS-EUIB|AVANT LOS VERDES|PODEMOS-EU|PODEMOS-IU-BATZARRE|PODEMOS-IX|MDyC") ~ "UP-IU",
str_detect(str_to_lower(siglas), "FRONT-ERC|ERC|PSM-EN,EU,EV,ER|ESQUERRA|esquerra|ERC-RI.cat|ERC - RI.cat / ESQUERRA|ERC-CATSÍ|ERC-CATSI|ERC-SOBIRAN|ERC-SOBIRANISTES") ~ "ERC",
#str_detect(str_to_lower(siglas), "") ~ "",
#str_detect(str_to_lower(siglas), "") ~ "",
str_detect(str_to_lower(siglas), "VOX") ~ "VOX",
TRUE ~ "OTROS"
),
fecha = glue::glue("{anno}-{mes}"),
id_mun = glue::glue("{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}")) |>
mutate(votos = sum(votos), .by = c(fecha, id_mun, siglas)) |>
distinct(fecha, id_mun, siglas, .keep_all = TRUE) |>
mutate(porc_voto = (votos / (votos_candidaturas + votos_candidaturas)) * 100,
.by = c(fecha, id_mun))
datos_elecciones_tidy <- datos_elecciones_tidy |>
mutate(
siglas_comun = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
str_detect(str_to_lower(siglas), "POSI|PSE-EE-PSOE|PSOE-PROGR.|SIEX|PSDEG-PSOE|PSOE|PSPC|PSE-EE(PSOE)|PSA|PSdeG-PSOE|PSOE de A|PSE-EE (PSOE)|P.S.O.E.|P.O.S.I.|PSD-FIA|PSOE-A|SSP-SxTF-EQUO|SXT|PSE-EE (PSO|PSE-EE|PSOE-NCa|PSC|FIA") ~ "PSOE",
str_detect(str_to_lower(siglas), "CENB|C's|Cenb|CenB|CNB|pCUA|C,S|CCD|FAC|U.C.I.T.|C´s|CILUS|CRA|CCD-CI|Cs|CILU-LINARE") ~ "Cs",
str_detect(str_to_lower(siglas), "EAJ-PNV|E.A.J.-P.N.V.") ~ "PNV",
str_detect(str_to_lower(siglas), "BNG|B.N.G.|NÓS|BNG-NÓS") ~ "BNG",
str_detect(str_to_lower(siglas), "COMPROMÍS-Q|PODEMOS-COM|PODEMOS - C|COMPROMÍS 2|MÉS COMPROM") ~ "COMPROMÍS",
str_detect(str_to_lower(siglas), "CIU|CiU") ~ "CIU",
str_detect(str_to_lower(siglas), "B-LV|EB-IU|IU|LVE|IULV-CA|LV|EU-IU|LV-GV|VERDES|PAVIEL|LV-CM|IU-CM|LVRM|CCS|IUN-NEB|PAS|IUC|CENB|LV-E|IU-SIEX|IU-LV|LVCM|CCSE|IU-BA|VERDES-IUC-AC25|EB-B|C's|Cenb|LV-EV|CenB|I.U.|EV-LV|AGRUCI|I.C.Bur|LOS VERDES|CNB|L.V.|pCUA|LOS VERDES DE EUROPA|C,S|LVCM-LVE|IU-CM.|I.U.R.M.|IU-B.A-LOS VERDES|UCPIC|AMAIUR|IUCLM-LV|EUPV-LV|IUCL|IU-VERDES-SIEX: La Izquierda Plural|CCD|IU-V-SIEX: LA IZQUIERDA PLURAL|CHA-IU|FAC|ACIMA|IUV-RM|IU-IX|IU CyL|IUC-IpH-LV|IUCyL|U.C.I.T.|IUCM-LV|IU-PDSC|PODEMOS-AHA|UP-UPeC|PODEMOS|PODEMOS-COM|CENTRO MODE|IULV-CA,UPe|C´s|UPB: IU-UPe|IULV-CA, UP|PODEMOS - C|UP: IULV-CA|PODEMOS-Aho|IU-CHA-UPeC|CILUS|CRA|X LA IZQUIE|IU-B-UPeC|IU-UPeC-IAS|CANARIAS DE|IUC-UPeC|EN POSITIU|UPeC-IU-IZC|JS,PC|UNIDAD POPU|PODEMOS/AHAL DUGU-IU-EQUO|PODEMOS-IU-EQUO|CENTRO MODERADO|PODEMOS-IU-|PODEMOS-IU-EQUO-CLIAS|PODEMOS-IU-EQUO-BATZARRE|PODEMOS-IU-EQUO-SEGOVIEMOS|PODEMOS-IU-EQUO-IZCA|CCD-CI|UNIDOS PODEMOS|Cs|AVANT-LOS V|PODEMOS-EUP|PODEMOS-IU|FRONT REPUB|AVANT ADELA|PODEMOS-EU-|CILU-LINARE|PODEMOS-IX-|PODEMOS-EUPV|AVANT ADELANTE LOS VERDES|PODEMOS-IU LV CA|PODEMOS-EUIB|AVANT LOS VERDES|PODEMOS-EU|PODEMOS-IU-BATZARRE|PODEMOS-IX|MDyC") ~ "UP-IU",
str_detect(str_to_lower(siglas), "FRONT-ERC|ERC|PSM-EN,EU,EV,ER|ESQUERRA|esquerra|ERC-RI.cat|ERC - RI.cat / ESQUERRA|ERC-CATSÍ|ERC-CATSI|ERC-SOBIRAN|ERC-SOBIRANISTES") ~ "ERC",
#str_detect(str_to_lower(siglas), "") ~ "",
#str_detect(str_to_lower(siglas), "") ~ "",
str_detect(str_to_lower(siglas), "VOX") ~ "VOX",
TRUE ~ "OTROS"
),
fecha = glue::glue("{anno}-{mes}"),
id_mun = glue::glue("{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}")) |>
mutate(votos = sum(votos), .by = c(fecha, id_mun, siglas)) |>
distinct(fecha, id_mun, siglas, .keep_all = TRUE) |>
mutate(porc_voto = (votos / (votos_candidaturas + votos_candidaturas)) * 100,
.by = c(fecha, id_mun))
datos_elecciones_tidy <- datos_elecciones_tidy |>
mutate(
siglas_comun = case_when(
str_detect(str_to_lower(siglas), "PP|UPN-PP|PP-UPM|P.P.|P.P-E.U.|PP-EU|PP-PAR|PP-FORO") ~ "PP",
str_detect(str_to_lower(siglas), "POSI|PSE-EE-PSOE|PSOE-PROGR.|SIEX|PSDEG-PSOE|PSOE|PSPC|PSE-EE(PSOE)|PSA|PSdeG-PSOE|PSOE de A|PSE-EE (PSOE)|P.S.O.E.|P.O.S.I.|PSD-FIA|PSOE-A|SSP-SxTF-EQUO|SXT|PSE-EE (PSOE)|PSE-EE|PSOE-NCa|PSC|FIA") ~ "PSOE",
str_detect(str_to_lower(siglas), "CENB|C's|Cenb|CenB|CNB|pCUA|C,S|CCD|FAC|U.C.I.T.|C´s|CILUS|CRA|CCD-CI|Cs|CILU-LINARE") ~ "Cs",
str_detect(str_to_lower(siglas), "EAJ-PNV|E.A.J.-P.N.V.") ~ "PNV",
str_detect(str_to_lower(siglas), "BNG|B.N.G.|NÓS|BNG-NÓS") ~ "BNG",
str_detect(str_to_lower(siglas), "COMPROMÍS-Q|PODEMOS-COM|PODEMOS - C|COMPROMÍS 2|MÉS COMPROM") ~ "COMPROMÍS",
str_detect(str_to_lower(siglas), "CIU|CiU") ~ "CIU",
str_detect(str_to_lower(siglas), "B-LV|EB-IU|IU|LVE|IULV-CA|LV|EU-IU|LV-GV|VERDES|PAVIEL|LV-CM|IU-CM|LVRM|CCS|IUN-NEB|PAS|IUC|CENB|LV-E|IU-SIEX|IU-LV|LVCM|CCSE|IU-BA|VERDES-IUC-AC25|EB-B|C's|Cenb|LV-EV|CenB|I.U.|EV-LV|AGRUCI|I.C.Bur|LOS VERDES|CNB|L.V.|pCUA|LOS VERDES DE EUROPA|C,S|LVCM-LVE|IU-CM.|I.U.R.M.|IU-B.A-LOS VERDES|UCPIC|AMAIUR|IUCLM-LV|EUPV-LV|IUCL|IU-VERDES-SIEX: La Izquierda Plural|CCD|IU-V-SIEX: LA IZQUIERDA PLURAL|CHA-IU|FAC|ACIMA|IUV-RM|IU-IX|IU CyL|IUC-IpH-LV|IUCyL|U.C.I.T.|IUCM-LV|IU-PDSC|PODEMOS-AHA|UP-UPeC|PODEMOS|PODEMOS-COM|CENTRO MODE|IULV-CA,UPe|C´s|UPB: IU-UPe|IULV-CA, UP|PODEMOS - C|UP: IULV-CA|PODEMOS-Aho|IU-CHA-UPeC|CILUS|CRA|X LA IZQUIE|IU-B-UPeC|IU-UPeC-IAS|CANARIAS DE|IUC-UPeC|EN POSITIU|UPeC-IU-IZC|JS,PC|UNIDAD POPU|PODEMOS/AHAL DUGU-IU-EQUO|PODEMOS-IU-EQUO|CENTRO MODERADO|PODEMOS-IU-|PODEMOS-IU-EQUO-CLIAS|PODEMOS-IU-EQUO-BATZARRE|PODEMOS-IU-EQUO-SEGOVIEMOS|PODEMOS-IU-EQUO-IZCA|CCD-CI|UNIDOS PODEMOS|Cs|AVANT-LOS V|PODEMOS-EUP|PODEMOS-IU|FRONT REPUB|AVANT ADELA|PODEMOS-EU-|CILU-LINARE|PODEMOS-IX-|PODEMOS-EUPV|AVANT ADELANTE LOS VERDES|PODEMOS-IU LV CA|PODEMOS-EUIB|AVANT LOS VERDES|PODEMOS-EU|PODEMOS-IU-BATZARRE|PODEMOS-IX|MDyC") ~ "UP-IU",
str_detect(str_to_lower(siglas), "FRONT-ERC|ERC|PSM-EN,EU,EV,ER|ESQUERRA|esquerra|ERC-RI.cat|ERC - RI.cat / ESQUERRA|ERC-CATSÍ|ERC-CATSI|ERC-SOBIRAN|ERC-SOBIRANISTES") ~ "ERC",
#str_detect(str_to_lower(siglas), "") ~ "",
#str_detect(str_to_lower(siglas), "") ~ "",
str_detect(str_to_lower(siglas), "VOX") ~ "VOX",
TRUE ~ "OTROS"
),
fecha = glue::glue("{anno}-{mes}"),
id_mun = glue::glue("{codigo_ccaa}-{codigo_provincia}-{codigo_municipio}")) |>
mutate(votos = sum(votos), .by = c(fecha, id_mun, siglas)) |>
distinct(fecha, id_mun, siglas, .keep_all = TRUE) |>
mutate(porc_voto = (votos / (votos_candidaturas + votos_candidaturas)) * 100,
.by = c(fecha, id_mun))
